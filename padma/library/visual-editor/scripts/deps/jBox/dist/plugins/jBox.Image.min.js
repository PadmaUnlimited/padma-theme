function jBoxImageWrapper(e,l){new e.plugin("Image",{src:"href",gallery:"data-jbox-image",imageLabel:"title",imageFade:360,imageSize:"contain",imageCounter:!1,imageCounterSeparator:"/",downloadButton:!1,downloadButtonText:null,downloadButtonUrl:null,mobileImageAttr:null,mobileImageBreakpoint:null,preloadFirstImage:!1,target:window,attach:"[data-jbox-image]",fixed:!0,blockScroll:!0,closeOnEsc:!0,closeOnClick:"button",closeButton:!0,overlay:!0,animation:"zoomIn",preventDefault:!0,width:"100%",height:"100%",adjustDistance:{top:40,right:0,bottom:40,left:0},_onInit:function(){this.images=this.currentImage={},this.imageZIndex=1,this.initImage=function(e){if(!(e=l(e)).data("jBox-image-gallery")){var t=e.attr(this.options.src);this.options.mobileImageAttr&&this.options.mobileImageBreakpoint&&e.attr(this.options.mobileImageAttr)&&l(window).width()<=this.options.mobileImageBreakpoint&&(t=e.attr(this.options.mobileImageAttr));var i=e.attr(this.options.gallery)||"default";this.images[i]||(this.images[i]=[]),this.images[i].push({src:t,label:e.attr(this.options.imageLabel)||"",downloadUrl:this.options.downloadButtonUrl&&e.attr(this.options.downloadButtonUrl)?e.attr(this.options.downloadButtonUrl):null}),"title"==this.options.imageLabel&&e.removeAttr("title"),e.data("jBox-image-gallery",i),e.data("jBox-image-id",this.images[i].length-1)}}.bind(this),this.attachedElements&&this.attachedElements.length&&l.each(this.attachedElements,function(e,t){this.initImage(t)}.bind(this));var n=function(e,t,i,a){if(!l("#jBox-image-"+e+"-"+t).length){var o=l("<div/>",{id:"jBox-image-"+e+"-"+t,class:"jBox-image-container"+(i?" jBox-image-"+e+"-current":"")}).css({backgroundSize:this.options.imageSize,opacity:a?1:0,zIndex:i?this.imageZIndex++:0}).appendTo(this.content);return this.swipeDetector(o).on("swipeLeft.sd swipeRight.sd",function(e){"swipeLeft"===e.type?this.showImage("next"):"swipeRight"===e.type&&this.showImage("prev")}.bind(this)),l("<div/>",{id:"jBox-image-label-"+e+"-"+t,class:"jBox-image-label"+(i?" active":"")}).html(this.images[e][t].label).click(function(){l(this).toggleClass("expanded")}).appendTo(this.imageLabelContainer),i&&o.animate({opacity:1},a?0:this.options.imageFade),o}}.bind(this);this.downloadImage=function(e){var t=document.createElement("a");t.href=e,t.setAttribute("download",e.substring(e.lastIndexOf("/")+1)),document.body.appendChild(t),t.click()};var s=function(t,i,e,a){var o=n(t,i,e,a);o.addClass("jBox-image-loading"),l('<img src="'+this.images[t][i].src+'" />').each(function(){var e=new Image;e.onload=function(){o.removeClass("jBox-image-loading"),o.css({backgroundImage:'url("'+this.images[t][i].src+'")'})}.bind(this),e.onerror=function(){o.removeClass("jBox-image-loading"),o.addClass("jBox-image-not-found")}.bind(this),e.src=this.images[t][i].src}.bind(this))}.bind(this);this.showImage=function(e){if("open"!=e){var t=this.currentImage.gallery;i=(i=this.currentImage.id+(+("prev"==e)?-1:1))>this.images[t].length-1?0:i<0?this.images[t].length-1:i}else{if(this.source){t=this.source.data("jBox-image-gallery");var i=this.source.data("jBox-image-id")}else{if(!this.attachedElements||!this.attachedElements.length)return;t=l(this.attachedElements[0]).data("jBox-image-gallery"),i=l(this.attachedElements[0]).data("jBox-image-id")}l(".jBox-image-pointer-prev, .jBox-image-pointer-next").css({display:1<this.images[t].length?"block":"none"})}var a,o;if(l(".jBox-image-"+t+"-current").length&&l(".jBox-image-"+t+"-current").removeClass("jBox-image-"+t+"-current").animate({opacity:0},"open"==e?0:this.options.imageFade),this.currentImage={gallery:t,id:i},l("#jBox-image-"+t+"-"+i).length?l("#jBox-image-"+t+"-"+i).addClass("jBox-image-"+t+"-current").css({zIndex:this.imageZIndex++,opacity:0}).animate({opacity:1},"open"==e?0:this.options.imageFade):s(t,i,!0,"open"===e),a=t,o=i,l(".jBox-image-label.active").removeClass("active expanded"),l("#jBox-image-label-"+a+"-"+o).addClass("active"),this.imageCounter&&(1<this.images[t].length?(this.wrapper.addClass("jBox-image-has-counter"),this.imageCounter.find(".jBox-image-counter-all").html(this.images[t].length),this.imageCounter.find(".jBox-image-counter-current").html(i+1)):this.wrapper.removeClass("jBox-image-has-counter")),this.images[t].length-1){var n=i+1;n=n>this.images[t].length-1?0:n<0?this.images[t].length-1:n,l("#jBox-image-"+t+"-"+n).length||s(t,n,!1,!1)}},this.options.preloadFirstImage&&l(window).on("load",function(){this.showImage("open")}.bind(this))},_onAttach:function(e){this.initImage&&this.initImage(e)},_onCreated:function(){this.imageLabelWrapper=l('<div class="jBox-image-label-wrapper"/>').appendTo(this.wrapper),this.imagePrevButton=l('<div class="jBox-image-pointer-prev"/>').on("click",function(){this.showImage("prev")}.bind(this)),this.imageNextButton=l('<div class="jBox-image-pointer-next"/>').on("click",function(){this.showImage("next")}.bind(this)),this.imageLabelContainer=l('<div class="jBox-image-label-container"/>'),this.imageLabelWrapper.append(this.imagePrevButton).append(this.imageLabelContainer).append(this.imageNextButton),this.options.downloadButton&&(this.downloadButton=l("<div/>",{class:"jBox-image-download-button-wrapper"}).appendTo(this.wrapper).append(this.options.downloadButtonText?l("<div/>",{class:"jBox-image-download-button-text"}).html(this.options.downloadButtonText):null).append(l("<div/>",{class:"jBox-image-download-button-icon"})).on("click touchdown",function(){if(this.images[this.currentImage.gallery][this.currentImage.id].downloadUrl)var e=this.images[this.currentImage.gallery][this.currentImage.id].downloadUrl;else e=this.wrapper.find(".jBox-image-"+this.currentImage.gallery+"-current")[0].style.backgroundImage.slice(4,-1).replace(/["']/g,"");this.downloadImage(e)}.bind(this))),this.options.imageCounter&&(this.imageCounter=l("<div/>",{class:"jBox-image-counter-container"}).insertAfter(this.imageLabelContainer),this.imageCounter.append(l("<span/>",{class:"jBox-image-counter-current"})).append(l("<span/>").html(this.options.imageCounterSeparator)).append(l("<span/>",{class:"jBox-image-counter-all"})))},_onOpen:function(){l(document).on("keyup.jBox-Image-"+this.id,function(e){37==e.keyCode&&this.showImage("prev"),39==e.keyCode&&this.showImage("next")}.bind(this)),this.showImage("open")},_onClose:function(){l(document).off("keyup.jBox-Image-"+this.id)},_onCloseComplete:function(){this.wrapper.find(".jBox-image-container").css("opacity",0)}})}